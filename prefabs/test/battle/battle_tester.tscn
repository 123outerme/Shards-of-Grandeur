[gd_scene load_steps=61 format=3 uid="uid://vgmb5l1ihc2p"]

[ext_resource type="Script" uid="uid://ba1n20fjtp4k5" path="res://prefabs/test/battle/battle_tester.gd" id="1_7scea"]
[ext_resource type="Resource" uid="uid://0qma1pdmr3vo" path="res://gamedata/combatants/mirage/mirage.tres" id="2_bwnp0"]
[ext_resource type="Script" uid="uid://by2yp7g75qdn0" path="res://scripts/overworld/overworld_enemy/static_encounter.gd" id="2_sffs8"]
[ext_resource type="Resource" uid="uid://ta4xvquq2dev" path="res://gamedata/combatants/tree_bear/tree_bear.tres" id="2_sul0p"]
[ext_resource type="Resource" uid="uid://3a2aqxqx230t" path="res://gamedata/items/armor/tempered_helm.tres" id="3_f7fe8"]
[ext_resource type="Script" uid="uid://dx4lnh4driy7a" path="res://scripts/battle/combatant/move.gd" id="4_egeqm"]
[ext_resource type="Resource" uid="uid://c48ja8pjniutk" path="res://gamedata/items/weapon/tangleroot_band.tres" id="5_unsrs"]
[ext_resource type="AudioStream" uid="uid://2enxrtp1rr6y" path="res://audio/music/battle/gateway_into_action.mp3" id="6_e5p5n"]
[ext_resource type="Resource" uid="uid://xgwynsla8o42" path="res://gamedata/items/weapon/kindling.tres" id="8_x7fe1"]
[ext_resource type="Script" uid="uid://cer6ruocsaiqt" path="res://scripts/battle/battle_scene/battle_command.gd" id="9_jd22b"]
[ext_resource type="Resource" uid="uid://bsx15gtbnpwml" path="res://gamedata/combatants/blob/blob.tres" id="9_qqchu"]
[ext_resource type="Script" uid="uid://flaq3s0m3pf2" path="res://scripts/reward/reward.gd" id="9_wpvco"]
[ext_resource type="Resource" uid="uid://biwy0v0u0bxam" path="res://gamedata/items/weapon/ice_gem.tres" id="10_0ecd1"]
[ext_resource type="Resource" uid="uid://bhg4i01ukcdvd" path="res://gamedata/combatants/rat/rat.tres" id="11_cl2mb"]
[ext_resource type="Script" uid="uid://bdxm8cikhf0o0" path="res://scripts/battle/win_conditions/survive_win_con.gd" id="13_5buqe"]
[ext_resource type="Resource" uid="uid://cjjf3h6v1senf" path="res://gamedata/moves/crooked_curse/crooked_curse.tres" id="16_evxqu"]
[ext_resource type="Script" uid="uid://biq3088m28kr2" path="res://scripts/battle/combatant/rune.gd" id="17_mfbgk"]
[ext_resource type="Resource" uid="uid://ct5mgs5qt8lsa" path="res://gamedata/moves/burning_heart/rune/sprite_rune_burning_heart_charge.tres" id="18_botcp"]
[ext_resource type="Script" uid="uid://cbb5diqsv44du" path="res://scripts/battle/battle_scene/turn_executor.gd" id="18_rw5pq"]
[ext_resource type="Script" uid="uid://byp0t0da4gqvn" path="res://scripts/battle/combatant/runes/damage_rune.gd" id="19_afxxh"]
[ext_resource type="Script" uid="uid://o561gt86qn0r" path="res://prefabs/test/battle/mock_battle_ui.gd" id="19_kmf14"]
[ext_resource type="Resource" uid="uid://b2bgowbjm3h46" path="res://gamedata/moves/burning_heart/rune/trigger_sprite_rune_burning_heart_charge.tres" id="20_1btmh"]
[ext_resource type="Script" uid="uid://cky0q11dkk4kj" path="res://scripts/battle/status_effects/reflect.gd" id="20_cl2mb"]
[ext_resource type="Script" uid="uid://spinf5kv548q" path="res://scripts/battle/weighted_things/weighted_stat_category.gd" id="20_jje8i"]
[ext_resource type="Script" uid="uid://b1w8kitcsyx7d" path="res://scripts/battle/combatant/stat_allocation_strategies/weighted_random_allocation_strategy.gd" id="21_6efxx"]
[ext_resource type="PackedScene" uid="uid://dmc2ox37dega8" path="res://prefabs/audio/audio_handler.tscn" id="21_y6pws"]
[ext_resource type="Resource" uid="uid://bbhpsfvhk3tnf" path="res://gamedata/moves/dehydration_curse/rune/sprite_rune_dehydration_curse_charge.tres" id="24_tnuo8"]
[ext_resource type="Script" uid="uid://b5mhqq6ioek3x" path="res://scripts/battle/combatant/runes/timed_rune.gd" id="25_mr7tq"]
[ext_resource type="Resource" uid="uid://deq4mt22y5vel" path="res://gamedata/moves/dehydration_curse/rune/trigger_sprite_rune_dehydration_curse_charge.tres" id="26_5qbqh"]
[ext_resource type="Resource" uid="uid://djpdjv3jnd7ud" path="res://gamedata/moves/marlin_spike/marlin_spike.tres" id="26_ss4d8"]
[ext_resource type="Resource" uid="uid://bq2u7u3bm6k5u" path="res://gamedata/moves/searing_rune/rune/sprite_rune_searing_rune_charge.tres" id="27_1rny2"]
[ext_resource type="Resource" uid="uid://cntmieslwj8h1" path="res://gamedata/moves/searing_rune/rune/trigger_sprite_rune_searing_rune_charge.tres" id="28_w0nhl"]
[ext_resource type="Resource" uid="uid://bcx60u36qshvn" path="res://gamedata/combatants/player/player.tres" id="28_yubvn"]
[ext_resource type="Resource" uid="uid://b6n834o6wy5o7" path="res://gamedata/moves/reckless_pact/reckless_pact.tres" id="32_cl2mb"]
[ext_resource type="Script" uid="uid://c4g8cps6yo76w" path="res://scripts/battle/status_effects/interception.gd" id="32_kwrsi"]
[ext_resource type="PackedScene" uid="uid://chpi5qfgk1cqj" path="res://prefabs/ui/sfx_button.tscn" id="33_snsqx"]
[ext_resource type="Resource" uid="uid://bdb03a6ibprre" path="res://gamedata/moves/rat_race/rat_race.tres" id="34_evxqu"]
[ext_resource type="Script" uid="uid://dohairjlp4nco" path="res://scripts/battle/status_effects/element_burn.gd" id="36_kwrsi"]
[ext_resource type="Resource" uid="uid://cpmh4qw3gwv3b" path="res://gamedata/items/healing/leavenport_loaf.tres" id="43_1s0me"]
[ext_resource type="PackedScene" uid="uid://bk5magi8dnwgj" path="res://prefabs/battle/battle_animation_manager.tscn" id="43_cxami"]
[ext_resource type="Script" uid="uid://fw22o8hbosnk" path="res://scripts/inventory/inventory_slot.gd" id="44_j7j6h"]

[sub_resource type="Resource" id="Resource_8ehk7"]
script = ExtResource("13_5buqe")
minTurns = 8
staticTotalDefeatRewards = Array[ExtResource("9_wpvco")]([])
winText = "You survived the battle!"
loseText = "You were defeated..."
escapeText = "You escaped successfully!"

[sub_resource type="Resource" id="Resource_eyqig"]
script = ExtResource("2_sffs8")
combatant1Level = 20
combatant1Moves = Array[ExtResource("4_egeqm")]([])
combatant1ShardSummoned = false
combatant2 = ExtResource("9_qqchu")
combatant2Level = 20
combatant2Weapon = ExtResource("10_0ecd1")
combatant2Moves = Array[ExtResource("4_egeqm")]([])
combatant2ShardSummoned = false
combatant3 = ExtResource("11_cl2mb")
combatant3Level = 20
combatant3Moves = Array[ExtResource("4_egeqm")]([])
combatant3ShardSummoned = false
autoAlly = ExtResource("2_bwnp0")
autoAllyLevel = 22
autoAllyArmor = ExtResource("3_f7fe8")
autoAllyWeapon = ExtResource("5_unsrs")
autoAllyMoves = Array[ExtResource("4_egeqm")]([])
autoAllyShardSummoned = false
specialBattleId = ""
bossBattle = true
canEscape = false
rewards = Array[ExtResource("9_wpvco")]([])
useStaticRewards = true
battleMusic = ExtResource("6_e5p5n")
combatant1 = ExtResource("2_sul0p")
combatant1Weapon = ExtResource("8_x7fe1")
specialRules = 0
winCon = SubResource("Resource_8ehk7")
customWinText = "Wrauuughhhhh...!"
battleMapPath = ""

[sub_resource type="Resource" id="Resource_snunq"]
script = ExtResource("9_jd22b")
type = 1
move = ExtResource("16_evxqu")
moveEffectType = 1
orbChange = 0
targetPositions = Array[String](["Bottom"])
randomNums = Array[float]([1.0])
selfRandomNum = -1.0
decisionsRandomNum = -1.0

[sub_resource type="Resource" id="Resource_3cd3y"]
script = ExtResource("20_jje8i")
category = 2
weight = 0.3

[sub_resource type="Resource" id="Resource_wm2w7"]
script = ExtResource("20_jje8i")
category = 0
weight = 0.5

[sub_resource type="Resource" id="Resource_pl5yt"]
script = ExtResource("20_jje8i")
category = 3
weight = 0.1

[sub_resource type="Resource" id="Resource_1i7gf"]
script = ExtResource("20_jje8i")
category = 4
weight = 0.1

[sub_resource type="Resource" id="Resource_h5dco"]
script = ExtResource("21_6efxx")
categories = Array[ExtResource("20_jje8i")]([SubResource("Resource_3cd3y"), SubResource("Resource_wm2w7"), SubResource("Resource_pl5yt"), SubResource("Resource_1i7gf")])

[sub_resource type="Resource" id="Resource_5gppg"]
script = ExtResource("20_cl2mb")
type = 8
potency = 1
overwritesOtherStatuses = false
turnsLeft = 3
metadata/_custom_type_script = "uid://cky0q11dkk4kj"

[sub_resource type="Resource" id="Resource_spqei"]
script = ExtResource("19_afxxh")
triggerElement = 0
triggerCategory = -1
isHealRune = false
previousHp = -1
orbChange = 1
category = 2
element = 2
power = -30
lifesteal = 0.0
runeSpriteAnim = ExtResource("18_botcp")
triggerAnim = ExtResource("20_1btmh")

[sub_resource type="Resource" id="Resource_xsbc3"]
script = ExtResource("25_mr7tq")
afterTurns = 3
turnCounter = 0
orbChange = 0
category = 1
element = 1
power = 40
lifesteal = 0.25
runeSpriteAnim = ExtResource("24_tnuo8")
triggerAnim = ExtResource("26_5qbqh")

[sub_resource type="Resource" id="Resource_0al0g"]
script = ExtResource("19_afxxh")
triggerElement = 2
triggerCategory = -1
isHealRune = false
previousHp = -1
orbChange = 0
category = 1
element = 2
power = 50
lifesteal = 0.0
runeSpriteAnim = ExtResource("27_1rny2")
triggerAnim = ExtResource("28_w0nhl")

[sub_resource type="Resource" id="Resource_cbcj4"]
script = ExtResource("44_j7j6h")
item = ExtResource("43_1s0me")
count = 1

[sub_resource type="Resource" id="Resource_el0wh"]
script = ExtResource("9_jd22b")
type = 2
moveEffectType = 0
orbChange = 0
slot = SubResource("Resource_cbcj4")
targetPositions = Array[String](["Ally"])
randomNums = Array[float]([0.5])
selfRandomNum = -1.0
decisionsRandomNum = -1.0

[sub_resource type="Resource" id="Resource_f67c7"]
script = ExtResource("32_kwrsi")
type = 9
potency = 1
overwritesOtherStatuses = true
turnsLeft = 5

[sub_resource type="Resource" id="Resource_mx2w5"]
script = ExtResource("9_jd22b")
type = 1
move = ExtResource("32_cl2mb")
moveEffectType = 1
orbChange = 1
targetPositions = Array[String](["Center"])
randomNums = Array[float]([0.0])
selfRandomNum = -1.0
decisionsRandomNum = -1.0

[sub_resource type="Resource" id="Resource_2nv1k"]
script = ExtResource("9_jd22b")
type = 1
move = ExtResource("26_ss4d8")
moveEffectType = 1
orbChange = 1
targetPositions = Array[String](["Ally"])
randomNums = Array[float]([0.5])
selfRandomNum = -1.0
decisionsRandomNum = -1.0

[sub_resource type="Resource" id="Resource_hmp4c"]
script = ExtResource("9_jd22b")
type = 1
move = ExtResource("34_evxqu")
moveEffectType = 1
orbChange = 1
targetPositions = Array[String](["Center", "Top", "Bottom"])
randomNums = Array[float]([])
selfRandomNum = -1.0
decisionsRandomNum = -1.0

[sub_resource type="Resource" id="Resource_lf1pv"]
script = ExtResource("36_kwrsi")
element = 7
power = 40.0
attackerStat = 110.0
attackerLv = 20
damageTriggered = false
type = 11
potency = 1
overwritesOtherStatuses = false
turnsLeft = 3
metadata/_custom_type_script = "uid://dohairjlp4nco"

[node name="BattleTester" type="Node2D" node_paths=PackedStringArray("globalMarker")]
script = ExtResource("1_7scea")
encounter = SubResource("Resource_eyqig")
_playerCombatant = ExtResource("28_yubvn")
playerLv = 22
playerOrbs = 3
playerCommand = SubResource("Resource_snunq")
playerStatAllocStrat = SubResource("Resource_h5dco")
playerStatus = SubResource("Resource_5gppg")
playerRunes = Array[ExtResource("17_mfbgk")]([SubResource("Resource_spqei"), SubResource("Resource_xsbc3"), SubResource("Resource_0al0g")])
playerRuneCasterPositions = Array[String](["Ally", "Center", "Center"])
minionCommand = SubResource("Resource_el0wh")
minionStatus = SubResource("Resource_f67c7")
enemy1Command = SubResource("Resource_mx2w5")
enemy2Command = SubResource("Resource_2nv1k")
enemy3Command = SubResource("Resource_hmp4c")
enemy3Status = SubResource("Resource_lf1pv")
globalMarker = NodePath("BattleAnimationManager/GlobalMarker")

[node name="BattleAnimationManager" parent="." instance=ExtResource("43_cxami")]

[node name="SurgeParticleEmitter" parent="BattleAnimationManager/PlayerCombatant/SpriteContainer/BehindParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="BehindParticleEmitter" parent="BattleAnimationManager/PlayerCombatant/SpriteContainer/BehindParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="FrontParticleEmitter" parent="BattleAnimationManager/PlayerCombatant/SpriteContainer/FrontParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="HitParticleEmitter" parent="BattleAnimationManager/PlayerCombatant/SpriteContainer/FrontParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="ShardParticleEmitter" parent="BattleAnimationManager/PlayerCombatant/SpriteContainer/FrontParticleContainer" index="2"]
startParticlesOnLoad = null

[node name="SurgeParticleEmitter" parent="BattleAnimationManager/MinionCombatant/SpriteContainer/BehindParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="BehindParticleEmitter" parent="BattleAnimationManager/MinionCombatant/SpriteContainer/BehindParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="FrontParticleEmitter" parent="BattleAnimationManager/MinionCombatant/SpriteContainer/FrontParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="HitParticleEmitter" parent="BattleAnimationManager/MinionCombatant/SpriteContainer/FrontParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="ShardParticleEmitter" parent="BattleAnimationManager/MinionCombatant/SpriteContainer/FrontParticleContainer" index="2"]
startParticlesOnLoad = null

[node name="EnemyCombatant1" parent="BattleAnimationManager" index="5"]
role = 1

[node name="SurgeParticleEmitter" parent="BattleAnimationManager/EnemyCombatant1/SpriteContainer/BehindParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="BehindParticleEmitter" parent="BattleAnimationManager/EnemyCombatant1/SpriteContainer/BehindParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="FrontParticleEmitter" parent="BattleAnimationManager/EnemyCombatant1/SpriteContainer/FrontParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="HitParticleEmitter" parent="BattleAnimationManager/EnemyCombatant1/SpriteContainer/FrontParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="ShardParticleEmitter" parent="BattleAnimationManager/EnemyCombatant1/SpriteContainer/FrontParticleContainer" index="2"]
startParticlesOnLoad = null

[node name="EnemyCombatant2" parent="BattleAnimationManager" index="6"]
role = 1

[node name="SurgeParticleEmitter" parent="BattleAnimationManager/EnemyCombatant2/SpriteContainer/BehindParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="BehindParticleEmitter" parent="BattleAnimationManager/EnemyCombatant2/SpriteContainer/BehindParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="FrontParticleEmitter" parent="BattleAnimationManager/EnemyCombatant2/SpriteContainer/FrontParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="HitParticleEmitter" parent="BattleAnimationManager/EnemyCombatant2/SpriteContainer/FrontParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="ShardParticleEmitter" parent="BattleAnimationManager/EnemyCombatant2/SpriteContainer/FrontParticleContainer" index="2"]
startParticlesOnLoad = null

[node name="EnemyCombatant3" parent="BattleAnimationManager" index="7"]
role = 1

[node name="SurgeParticleEmitter" parent="BattleAnimationManager/EnemyCombatant3/SpriteContainer/BehindParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="BehindParticleEmitter" parent="BattleAnimationManager/EnemyCombatant3/SpriteContainer/BehindParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="FrontParticleEmitter" parent="BattleAnimationManager/EnemyCombatant3/SpriteContainer/FrontParticleContainer" index="0"]
startParticlesOnLoad = null

[node name="HitParticleEmitter" parent="BattleAnimationManager/EnemyCombatant3/SpriteContainer/FrontParticleContainer" index="1"]
startParticlesOnLoad = null

[node name="ShardParticleEmitter" parent="BattleAnimationManager/EnemyCombatant3/SpriteContainer/FrontParticleContainer" index="2"]
startParticlesOnLoad = null

[node name="BattlefieldShade" parent="BattleAnimationManager" index="8"]
offset_top = -90.0
offset_bottom = 43.0

[node name="TurnExecutor" type="Node" parent="." node_paths=PackedStringArray("battleController", "battleUI")]
script = ExtResource("18_rw5pq")
battleController = NodePath("..")
battleUI = NodePath("../MockBattleUI")

[node name="MockBattleUI" type="Camera2D" parent="." node_paths=PackedStringArray("battleController")]
zoom = Vector2(4, 4)
script = ExtResource("19_kmf14")
menuState = 6
battleController = NodePath("..")

[node name="AudioHandler" parent="." instance=ExtResource("21_y6pws")]

[node name="SfxButton" parent="." instance=ExtResource("33_snsqx")]
offset_left = -25.0
offset_top = 49.0
offset_right = 30.0
offset_bottom = 80.0
text = "Next"

[connection signal="combatant_animation_complete" from="BattleAnimationManager" to="." method="_on_battle_animation_manager_combatant_animation_complete"]
[connection signal="combatant_animation_start" from="BattleAnimationManager" to="." method="_on_battle_animation_manager_combatant_animation_start"]

[editable path="BattleAnimationManager"]
[editable path="BattleAnimationManager/PlayerCombatant"]
[editable path="BattleAnimationManager/PlayerCombatant/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/PlayerCombatant/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/MinionCombatant"]
[editable path="BattleAnimationManager/MinionCombatant/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/MinionCombatant/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/EnemyCombatant1"]
[editable path="BattleAnimationManager/EnemyCombatant1/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/EnemyCombatant1/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/EnemyCombatant2"]
[editable path="BattleAnimationManager/EnemyCombatant2/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/EnemyCombatant2/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/EnemyCombatant3"]
[editable path="BattleAnimationManager/EnemyCombatant3/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/EnemyCombatant3/HPTag/OrbDisplay"]
