[gd_scene load_steps=51 format=3 uid="uid://dgqo8vipb17e8"]

[ext_resource type="Script" uid="uid://dnpxh71dijpok" path="res://prefabs/test/battle/full_battle_tester.gd" id="1_cwe7c"]
[ext_resource type="Script" uid="uid://dflemol3c36f5" path="res://scripts/battle/combatant/combatant_ai_layer.gd" id="2_plygy"]
[ext_resource type="Resource" uid="uid://c8dsnwkhkmu58" path="res://gamedata/combatants/savage_horse/savage_horse.tres" id="2_yques"]
[ext_resource type="Resource" uid="uid://b101o7kvw7n3f" path="res://gamedata/items/armor/shady_cloak.tres" id="3_lyqws"]
[ext_resource type="Resource" uid="uid://cnjto6nnsswit" path="res://gamedata/combatants/chain_legion_mage/visual_variants/1/chain_legion_mage_2.tres" id="3_r8t11"]
[ext_resource type="Resource" uid="uid://b14w15l2gg5oc" path="res://gamedata/combatants/storm_swarm/storm_swarm.tres" id="4_eh7hq"]
[ext_resource type="Script" uid="uid://dx4lnh4driy7a" path="res://scripts/battle/combatant/move.gd" id="4_nwagl"]
[ext_resource type="Resource" uid="uid://df8cprg6vpti3" path="res://gamedata/items/weapon/curved_knife.tres" id="5_5o7dv"]
[ext_resource type="Resource" uid="uid://bhg4i01ukcdvd" path="res://gamedata/combatants/rat/rat.tres" id="5_k0g70"]
[ext_resource type="Script" uid="uid://w2owehn7fmot" path="res://scripts/battle/combatant/combatant_ai.gd" id="8_ewn23"]
[ext_resource type="Script" uid="uid://flaq3s0m3pf2" path="res://scripts/reward/reward.gd" id="9_u0r64"]
[ext_resource type="Script" uid="uid://by2yp7g75qdn0" path="res://scripts/overworld/overworld_enemy/static_encounter.gd" id="10_821vc"]
[ext_resource type="Script" uid="uid://spinf5kv548q" path="res://scripts/battle/weighted_things/weighted_stat_category.gd" id="16_vlt6a"]
[ext_resource type="Resource" uid="uid://ddbx7btl312ii" path="res://gamedata/combatants/player/player_evolutions.tres" id="17_em4kh"]
[ext_resource type="Script" uid="uid://b1w8kitcsyx7d" path="res://scripts/battle/combatant/stat_allocation_strategies/weighted_random_allocation_strategy.gd" id="17_nsk2h"]
[ext_resource type="Resource" uid="uid://bcyc6jiut3ng3" path="res://gamedata/combatants/player/player_effectiveness.tres" id="18_nxyit"]
[ext_resource type="Script" uid="uid://dyckeornewpwi" path="res://scripts/battle/combatant.gd" id="19_f2kpt"]
[ext_resource type="Resource" uid="uid://dvr8s8ujdy6f1" path="res://gamedata/combatants/player/player_sprite.tres" id="20_l4ilx"]
[ext_resource type="Resource" uid="uid://crei2j1v6q4jn" path="res://gamedata/moves/slice/slice.tres" id="21_dnn8x"]
[ext_resource type="Resource" uid="uid://jhhxu2gbjenp" path="res://gamedata/items/armor/standard_issue_mail.tres" id="21_lhelt"]
[ext_resource type="PackedScene" uid="uid://bk5magi8dnwgj" path="res://prefabs/battle/battle_animation_manager.tscn" id="22_3prau"]
[ext_resource type="Resource" uid="uid://bx6u2bgxrbymu" path="res://gamedata/items/weapon/tome_vol_1.tres" id="22_ge00y"]
[ext_resource type="Resource" uid="uid://b7fwd75mauun" path="res://gamedata/moves/mage_blast/mage_blast.tres" id="22_o4y65"]
[ext_resource type="Script" uid="uid://cwh7p05135w7q" path="res://scripts/battle/combatant/movepool.gd" id="23_h4pwx"]
[ext_resource type="Script" uid="uid://biq3088m28kr2" path="res://scripts/battle/combatant/rune.gd" id="23_jq1m7"]
[ext_resource type="Script" uid="uid://cbb5diqsv44du" path="res://scripts/battle/battle_scene/turn_executor.gd" id="23_l1bd4"]
[ext_resource type="Resource" uid="uid://bkye5pxmqsb6m" path="res://gamedata/moves/draining_bolt/draining_bolt.tres" id="24_606y3"]
[ext_resource type="Script" uid="uid://c8dxuthm1qd7s" path="res://scripts/battle/combatant/stats.gd" id="24_n2rm1"]
[ext_resource type="Script" uid="uid://o561gt86qn0r" path="res://prefabs/test/battle/mock_battle_ui.gd" id="24_w6tqk"]
[ext_resource type="PackedScene" uid="uid://dmc2ox37dega8" path="res://prefabs/audio/audio_handler.tscn" id="25_e1byn"]
[ext_resource type="Resource" uid="uid://ddxdw8fyirruw" path="res://gamedata/combatants/player/player_stat_growth.tres" id="25_lyeej"]
[ext_resource type="PackedScene" uid="uid://chpi5qfgk1cqj" path="res://prefabs/ui/sfx_button.tscn" id="26_76nyc"]
[ext_resource type="Resource" uid="uid://poj2favclae8" path="res://gamedata/moves/battle_trance/battle_trance.tres" id="26_yy50f"]
[ext_resource type="Resource" uid="uid://bnlxt86bvm38f" path="res://gamedata/moves/tidal_wave/tidal_wave.tres" id="30_1bgbv"]
[ext_resource type="Resource" uid="uid://dxwkpv5vlcigq" path="res://gamedata/moves/thunderstrike/thunderstrike.tres" id="31_etk0a"]
[ext_resource type="Resource" uid="uid://bbhpsfvhk3tnf" path="res://gamedata/moves/dehydration_curse/rune/sprite_rune_dehydration_curse_charge.tres" id="32_xgqge"]
[ext_resource type="Script" uid="uid://byp0t0da4gqvn" path="res://scripts/battle/combatant/runes/damage_rune.gd" id="33_wyqeh"]
[ext_resource type="Resource" uid="uid://deq4mt22y5vel" path="res://gamedata/moves/dehydration_curse/rune/trigger_sprite_rune_dehydration_curse_charge.tres" id="34_or6fd"]
[ext_resource type="Script" uid="uid://b43b01xgamb3f" path="res://prefabs/test/mock_audio_handler.gd" id="35_0y1m3"]
[ext_resource type="Script" uid="uid://cky0q11dkk4kj" path="res://scripts/battle/status_effects/reflect.gd" id="38_84ulj"]

[sub_resource type="Resource" id="Resource_uap67"]
script = ExtResource("10_821vc")
combatant1Level = 21
combatant1Moves = Array[ExtResource("4_nwagl")]([])
combatant1ShardSummoned = false
combatant2 = ExtResource("4_eh7hq")
combatant2Level = 21
combatant2Moves = Array[ExtResource("4_nwagl")]([])
combatant2ShardSummoned = false
combatant3 = ExtResource("5_k0g70")
combatant3Level = 20
combatant3Moves = Array[ExtResource("4_nwagl")]([])
combatant3ShardSummoned = false
autoAlly = ExtResource("2_yques")
autoAllyLevel = 22
autoAllyArmor = ExtResource("3_lyqws")
autoAllyWeapon = ExtResource("5_5o7dv")
autoAllyMoves = Array[ExtResource("4_nwagl")]([])
autoAllyShardSummoned = false
specialBattleId = "standstill_cl_mage_3"
bossBattle = false
canEscape = false
rewards = Array[ExtResource("9_u0r64")]([])
useStaticRewards = false
combatant1 = ExtResource("3_r8t11")
specialRules = 0
customWinText = "\"I guess the party's over... I'll be cool for now.\""
battleMapPath = ""

[sub_resource type="Resource" id="Resource_5jl4o"]
script = ExtResource("23_h4pwx")
pool = Array[ExtResource("4_nwagl")]([ExtResource("21_dnn8x"), ExtResource("22_o4y65")])
signatureMoves = Array[ExtResource("4_nwagl")]([])
preferredMove1Role = 0
preferredMove1DmgType = -1
preferredMove1Element = 0
preferredMove2Role = 0
preferredMove2DmgType = -1
preferredMove2Element = 0
preferredMove3Role = 0
preferredMove3DmgType = -1
preferredMove3Element = 0
preferredMove4Role = 0
preferredMove4DmgType = -1
preferredMove4Element = 0

[sub_resource type="Resource" id="Resource_ln7df"]
script = ExtResource("24_n2rm1")
displayName = "Player"
saveName = "player"
level = 1
experience = 0
maxHp = 50
physAttack = 1
magicAttack = 1
resistance = 1
affinity = 1
speed = 1
statPts = 0
statGrowth = ExtResource("25_lyeej")
equippedWeapon = ExtResource("22_ge00y")
equippedArmor = ExtResource("21_lhelt")
moves = Array[ExtResource("4_nwagl")]([ExtResource("24_606y3"), ExtResource("30_1bgbv"), ExtResource("31_etk0a"), ExtResource("26_yy50f")])
movepool = SubResource("Resource_5jl4o")

[sub_resource type="Resource" id="Resource_7loi3"]
script = ExtResource("19_f2kpt")
sprite = ExtResource("20_l4ilx")
nickname = ""
stats = SubResource("Resource_ln7df")
evolutions = ExtResource("17_em4kh")
evolutionStats = {}
minionStatAllocMode = -1
currentHp = -1
orbs = 0
runes = Array[ExtResource("23_jq1m7")]([])
triggeredRunes = Array[ExtResource("23_jq1m7")]([])
triggeredRunesDmg = Array[int]([])
triggeredRunesStatus = Array[bool]([])
friendship = 0.0
maxFriendship = 30.0
version = ""
aiType = 0
damageAggroType = 0
strategy = 0
aiOverrideWeight = 0.0
moveEffectiveness = ExtResource("18_nxyit")
downed = false
battleStorageHp = -1
battleStorageOrbs = -1

[sub_resource type="Resource" id="Resource_q6qyh"]
script = ExtResource("8_ewn23")
layers = Array[ExtResource("2_plygy")]([])
orbSpendStrategy = 0
stalenessTolerance = 1.4
lastMovesEffect = 0
timesUsedLastMove = 0

[sub_resource type="Resource" id="Resource_rtfcg"]
script = ExtResource("16_vlt6a")
category = 1
weight = 0.65

[sub_resource type="Resource" id="Resource_wru7h"]
script = ExtResource("16_vlt6a")
category = 2
weight = 0.35

[sub_resource type="Resource" id="Resource_mniaa"]
script = ExtResource("17_nsk2h")
categories = Array[ExtResource("16_vlt6a")]([SubResource("Resource_rtfcg"), SubResource("Resource_wru7h")])

[sub_resource type="Resource" id="Resource_6iopj"]
script = ExtResource("38_84ulj")
type = 8
potency = 1
overwritesOtherStatuses = false
turnsLeft = 3

[sub_resource type="Resource" id="Resource_0rwdc"]
script = ExtResource("33_wyqeh")
triggerElement = 0
isHealRune = false
previousHp = -1
orbChange = 0
category = 1
element = 1
power = 40
lifesteal = 0.25
runeSpriteAnim = ExtResource("32_xgqge")
triggerAnim = ExtResource("34_or6fd")

[node name="FullBattleTester" type="Node2D"]
script = ExtResource("1_cwe7c")
useBattleAnims = false
encounter = SubResource("Resource_uap67")
_playerCombatant = SubResource("Resource_7loi3")
playerLv = 22
playerAi = SubResource("Resource_q6qyh")
playerStatAllocStrat = SubResource("Resource_mniaa")
playerStatus = SubResource("Resource_6iopj")
enemy1Runes = Array[ExtResource("23_jq1m7")]([SubResource("Resource_0rwdc")])
enemy1RuneCasterPositions = Array[String](["You"])

[node name="BattleAnimationManager" parent="." instance=ExtResource("22_3prau")]

[node name="EnemyCombatant1" parent="BattleAnimationManager" index="5"]
role = 1

[node name="EnemyCombatant2" parent="BattleAnimationManager" index="6"]
role = 1

[node name="EnemyCombatant3" parent="BattleAnimationManager" index="7"]
role = 1

[node name="BattlefieldShade" parent="BattleAnimationManager" index="8"]
offset_top = -90.0
offset_bottom = 43.0

[node name="TurnExecutor" type="Node" parent="." node_paths=PackedStringArray("battleController", "battleUI")]
script = ExtResource("23_l1bd4")
battleController = NodePath("..")
battleUI = NodePath("../MockBattleUI")

[node name="MockBattleUI" type="Camera2D" parent="." node_paths=PackedStringArray("battleController")]
zoom = Vector2(4, 4)
script = ExtResource("24_w6tqk")
menuState = 6
battleController = NodePath("..")

[node name="MockAudioHandler" parent="." instance=ExtResource("25_e1byn")]
script = ExtResource("35_0y1m3")

[node name="SfxButton" parent="." instance=ExtResource("26_76nyc")]
offset_left = -25.0
offset_top = 49.0
offset_right = 30.0
offset_bottom = 80.0
text = "Next"

[connection signal="combatant_animation_complete" from="BattleAnimationManager" to="." method="_on_battle_animation_manager_combatant_animation_complete"]
[connection signal="combatant_animation_start" from="BattleAnimationManager" to="." method="_on_battle_animation_manager_combatant_animation_start"]

[editable path="BattleAnimationManager"]
[editable path="BattleAnimationManager/PlayerCombatant"]
[editable path="BattleAnimationManager/PlayerCombatant/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/PlayerCombatant/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/MinionCombatant"]
[editable path="BattleAnimationManager/MinionCombatant/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/MinionCombatant/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/EnemyCombatant1"]
[editable path="BattleAnimationManager/EnemyCombatant1/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/EnemyCombatant1/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/EnemyCombatant2"]
[editable path="BattleAnimationManager/EnemyCombatant2/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/EnemyCombatant2/HPTag/OrbDisplay"]
[editable path="BattleAnimationManager/EnemyCombatant3"]
[editable path="BattleAnimationManager/EnemyCombatant3/SpriteContainer/FrontParticleContainer/HitParticleEmitter"]
[editable path="BattleAnimationManager/EnemyCombatant3/HPTag/OrbDisplay"]
